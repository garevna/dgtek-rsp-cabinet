(()=>{"use strict";var t,e,s={94:(t,e,s)=>{s.d(e,{q1:()=>o,sh:()=>i,ho:()=>n,_j:()=>a,Ch:()=>u,$S:()=>l,V5:()=>d});const{buildingsController:r}=s(383),a={host:r.setBuildingsHostURL,key:r.setBuildingsApiKey,refresh:r.storeBuildings,list:r.getBuildingsList,data:r.getBuildingsData,search:r.searchBuilding,getById:r.getBuildingDataById,getByAddress:r.getBuildingDataByAddress,put:r.putBuildingData,post:r.postBuildingData,patch:r.patchBuildingData},n=function(){let t="https://portal.dgtek.net";return function(e){if(!e)return t;t=e}}(),o=function(){let t="";return function(e){if(!e)return t;t=e}}(),i=["lit","footprint","build","soon","other","current"],u={lit:"LIT",footprint:"Footprint",build:"BuildCommenced",soon:"ComingSoon",other:"Other"},l={LIT:"lit",Footprint:"footprint",BuildCommenced:"build",ComingSoon:"soon",Other:"other"},d={lit:{event:"on-net",buildingStatus:"LIT",polygonStatus:"ServiceAvailable"},footprint:{event:"footprint",buildingStatus:"Footprint",polygonStatus:"ServiceAvailable"},build:{event:"construction-commenced",buildingStatus:"BuildCommenced",polygonStatus:"UnderConstruction"},soon:{event:"coming-soon",buildingStatus:"ComingSoon",polygonStatus:"ComingSoon"},other:{event:"not-available",buildingStatus:"Other",polygonStatus:null}}},383:(t,e,s)=>{s.r(e),s.d(e,{buildingsController:()=>o});var r=s(665),a=s(356),n=s(94);const o=new class{setBuildingsHostURL(t){(0,n.ho)(t.data)}setBuildingsApiKey(t){(0,n.q1)(t.data)}async storeBuildings(){self.postMessage(await(0,r.km)())}async getBuildingsList(t){self.postMessage(await(0,r.Yp)(t.key))}async getBuildingsData(t){self.postMessage(await(0,r.ml)(t.key))}async searchBuilding(t){self.postMessage(await(0,r.ig)(t.key))}async getBuildingDataById(t){self.postMessage(await(0,a.Pd)(t.key))}async getBuildingDataByAddress(t){self.postMessage(await(0,r.SF)(t.key))}async putBuildingData(t){self.postMessage(await(0,a.p1)(t.key,t.data))}async patchBuildingData(t){self.postMessage(await(0,a.OE)(t.key,t.data))}async postBuildingData(t){self.postMessage(await(0,a.FX)(t.data))}}},356:(t,e,s)=>{s.d(e,{Pd:()=>n,OE:()=>c,FX:()=>f,p1:()=>l,km:()=>h});var r=s(94),a=s(893);const n=async t=>{if(!navigator.onLine)return{status:0,result:"Offline mode: Data has not been saved. Try later"};const[e,s]=["getById",t],n=await fetch(`${(0,r.ho)()}/building/${t}`);if(200!==n.status)return{status:n.status,action:e,key:s,result:`Error reading building ${t} data`};const o=(await n.json()).data;return await(0,a.UX)("current","data",o),{status:n.status,action:e,store:o.status,key:s,result:o}};var o=s(665);const i=(t,e="saved")=>({status:0,action:t,error:!0,errorType:"Offline",message:`Offline mode: Data has not been ${e}. Try later`,result:`Offline mode: Data has not been ${e}. Try later`}),u=(t=500,e="building")=>({status:t,action:"put",key:e,error:!0,errorType:`Update ${e} details`,errorMessage:"Operation failed"}),l=async function(t,e){const s=t;let o=await n(t);if(200!==o.status)return getError(o.status,t);if(Object.assign(o.result,{...e}),!navigator.onLine)return i("put","saved");if(o=await fetch(`${(0,r.ho)()}/building/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:(0,r.q1)()},body:JSON.stringify(o.result)}),200!==o.status)return u(o.status,e.address);const{address:l,addressComponents:d,coordinates:c,distanceFromFootprint:g,estimatedServiceDeliveryTime:p,status:f}=await o.json(),y={LIT:"lit",Footprint:"footprint",BuildCommenced:"build",ComingSoon:"soon",Other:"other"}[f],m=await(0,a.UX)(y,l,{address:l,addressComponents:d,coordinates:c,distanceFromFootprint:g,estimatedServiceDeliveryTime:p,status:f,_id:t});return 200!==m.status?u(m.status,e.address):{action:"put",key:s,status:o.status,result:m}},d="patch",c=async function(t,e){const s=t;let n=!1;if(!navigator.onLine)return i;if(e.status){if(!e.address)return{status:422,action:d,key:s,data:e,message:"Invalid request: address needed"};const t=await(0,o.ig)(e.address);if(200!==t.status)return((t,e="Building",s=404)=>({status:s,action:t,key:e,error:!0,errorType:"Building not found",errorMessage:`${e} not found in local DB`}))(d,e.address,t.status);n=t.result.status!==e.status}n&&await(0,o.mY)(e.address);const l=await fetch(`${(0,r.ho)()}/building/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:(0,r.q1)()},body:JSON.stringify(e)});if(200!==l.status)return u("patch",l.status,e.address);const{address:c,addressComponents:g,coordinates:p,distanceFromFootprint:f,estimatedServiceDeliveryTime:y,status:m}=(await l.json()).data,b={LIT:"lit",Footprint:"footprint",BuildCommenced:"build",ComingSoon:"soon",Other:"other"}[m],h=await(0,a.UX)(b,c,{address:c,addressComponents:g,coordinates:p,distanceFromFootprint:f,estimatedServiceDeliveryTime:y,status:m,_id:t});return 200!==h.status?u(h.status,e.address):{status:l.status,action:d,key:s,result:h}},g=(t=422,e="Operation failed")=>({status:t,action:"post",error:!0,errorType:"Create new building",errorMessage:e}),p="post",f=async t=>{if(!navigator.onLine)return i(p,"saved");if(!t.status)return g(422,"Building status not defined");const e=r.$S[t.status];if(!e)return g(422,`Invalid building status ${t.status}`);const{status:s,address:n,addressComponents:l,coordinates:d}=t,c=await(0,o.ig)(n);if(c.result&&c.result._id)return{status:200,action:p,store:e,key:n,result:c.result._id,message:!0,messageType:"Creating new building",messageText:`Building ${t.address} already exists`};const f={status:s,address:n,addressComponents:l,coordinates:d,levels:[],owner:{},management:{},concierge:{},infrastructure:{},estimatedServiceDeliveryTime:""},y=await fetch(`${(0,r.ho)()}/building`,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:(0,r.q1)()},body:JSON.stringify(f)});if(200!==y.status)return g(y.status,await y.json());const m=(await y.json()).data,{status:b,result:h}=await(0,a.UX)(e,n,Object.assign(f,{_id:m}));return 200!==b?u(b,"Error saving the data to local DB"):{status:200,action:p,store:e,key:n,result:m}},y=(t,e=500,s="Error reading data from remote server")=>({status:e,action:t,error:!0,errorType:"Remote server error",errorMessage:s,result:s}),m=(t,e=400,s="Error saving the data to local DB")=>({status:e,action:t,error:!0,errorType:"Local DB error",errorMessage:s,result:s}),b="init",h=async()=>{if(!navigator.onLine)return i(b,"received");let t=1,e=!1;for(await Promise.all(Object.keys(r.Ch).map((t=>(0,a.YF)(t))));!e;){const s=await fetch(`${(0,r.ho)()}/building?per_page={perPage}&page=${t++}`);if(200!==s.status)return y("init",s.status);const a=await s.json(),n=a.data;e=a.pages<=a.page;const i=await(0,o.ls)(n);if(!i||!Array.isArray(i)||i.filter((t=>200!==t.status)).length)return m("init")}return{status:200,action:b,result:"OK"}}},893:(t,e,s)=>{s.d(e,{YF:()=>d,Ob:()=>l,go:()=>u,NW:()=>i,gJ:()=>o,UX:()=>n});var r=s(94);const a=()=>new Promise((t=>Object.assign(indexedDB.open("buildings"),{onupgradeneeded:t=>{for(const e of r.sh)t.target.result.createObjectStore(e);return t.target.result},onsuccess:e=>t({status:200,result:e.target.result}),onerror:e=>t({status:700,result:null})}))),n=async(t,e,s)=>new Promise((r=>{a().then((a=>{const{status:n,result:o}=a;if(200!==n)return void r({status:n,result:"Open local DB error"});const i=o.transaction([t],"readwrite").objectStore(t);Object.assign(i.put(s,e),{onsuccess:()=>r({status:200,result:s}),onerror:()=>r({status:708,result:`Local DB saving data error: ${e}`})})}))})),o=(t,e)=>new Promise((s=>{a().then((r=>{const{status:a,result:n}=r;if(200!==a)return void s({status:a,result:null});const o=n.transaction([t]).objectStore(t);Object.assign(o.get(e),{onsuccess:r=>s({status:r.target.result?200:404,result:r.target.result?r.target.result:`The data ${e} not found in db store ${t}`}),onerror:t=>s({status:704,result:t.target.error})})}))})),i=t=>new Promise((e=>{a().then((s=>{const{status:r,result:a}=s;if(200!==r)return void e({status:r,result:null});const n=a.transaction([t]).objectStore(t);return Object.assign(n.getAllKeys(),{onsuccess:s=>e({status:s.target.result?200:404,result:s.target.result?s.target.result:`No one key found in db store ${t}`}),onerror:t=>e({status:704,result:t.target.error})})}))})),u=t=>new Promise((e=>{a().then((s=>{const{status:r,result:a}=s;if(200!==r)return void e({status:r,result:null});const n=a.transaction([t]).objectStore(t);return Object.assign(n.getAll(),{onsuccess:s=>e({status:s.target.result?200:404,result:s.target.result?s.target.result:`No one key found in db store ${t}`}),onerror:t=>e({status:704,result:t.target.error})})}))})),l=(t,e)=>new Promise((s=>{a().then((r=>{const{status:a,result:n}=r;if(200!==a)return void s({status:a,result:null});const o=n.transaction([t],"readwrite").objectStore(t);Object.assign(o.delete(e),{onsuccess:r=>s({action:"delete",store:t,status:r.target.result?200:404,result:r.target.result?r.target.result:`${e} not found in db store ${t}`}),onerror:t=>s({status:400,result:t.target.error})})}))})),d=t=>new Promise((e=>{a().then((s=>{const{status:r,result:a}=s;if(200!==r)return void e({status:r,result:null});const n=a.transaction([t],"readwrite").objectStore(t);Object.assign(n.clear(),{onsuccess:t=>e({status:200,result:null}),onerror:s=>e({status:704,result:`Cleaning ${t}: operation failed`})})}))}))},665:(t,e,s)=>{s.d(e,{mY:()=>f,SF:()=>n,ml:()=>d,Yp:()=>l,ls:()=>u,ig:()=>g,km:()=>r.km});var r=s(356);const a="getByAddress",n=async t=>{const e=await g(t);if(200!==e.status)return((t=404,e="Building")=>({status:t,store:"Not found",action:a,key:e,result:null,error:!0,errorType:"Search building by address",errorMessage:`${e} was not found`}))(e.status,t);const{status:s,store:n,result:o}=await(0,r.Pd)(e.result._id);return{status:s,action:a,store:e.store,key:t,result:o}};var o=s(893),i=s(94);const u=async function(t){const e=[];for(const s in i.Ch){const r=t.filter((t=>t.status===i.Ch[s]));for(const t of r){const{address:r}=t;e.push((0,o.UX)(s,r,t))}}return await Promise.all(e)},l=async t=>{const[e,s]=["list",t];if(-1===Object.keys(i.Ch).indexOf(t))return{status:422,action:e,store:s,result:`Invalid request: type ${t} not found`};const{status:r,result:a}=await(0,o.NW)(t);return{status:r,store:s,action:e,result:Object.assign(a,{event:i.V5[s].event,buildingStatus:i.V5[s].buildingStatus,polygonStatus:i.V5[s].polygonStatus})}},d=async t=>{const[e,s]=["data",t];if(-1===Object.keys(i.Ch).indexOf(t))return{status:422,action:e,store:s,result:`Invalid request: type ${t} not found`};const{status:r,result:a}=await(0,o.go)(t),n=a.map((t=>({id:t._id,address:t.address,addressComponents:t.addressComponents,estimatedServiceDeliveryTime:t.estimatedServiceDeliveryTime})));return{status:r,action:e,store:s,result:Object.assign(n,{event:i.V5[s].event,buildingStatus:i.V5[s].buildingStatus,polygonStatus:i.V5[s].polygonStatus})}},c="search",g=async t=>{for(const e in i.Ch){const{status:s,result:r}=await(0,o.gJ)(e,t);if(200===s)return{status:s,action:c,store:e,key:t,result:r}}return{status:404,action:c,key:t,store:"Not found",result:null}},p=["lit","footprint","build","soon","other"],f=async t=>{for(const e of p){const s=await(0,o.Ob)(e,t);if(200===s.status)return s}return{status:404,action:"delete",key:t}}}},r={};function a(t){var e=r[t];if(void 0!==e)return e.exports;var n=r[t]={exports:{}};return s[t](n,n.exports,a),n.exports}a.d=(t,e)=>{for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},t=a(94),e=a(665),(0,t.ho)("https://portal.dgtek.net"),(0,t.q1)("rAxKIAyY9j3Aq0OZ4TnGHCibU9G6oZZP8NaMOlKeJV9U2qjOKu0xOOQwjw3JzKaewN4DmzQ97aEsUh1XyAsQboJqQpbFpgK0JQkt"),(0,e.km)().then((e=>{self.postMessage(e),200===e.status&&(self.onmessage=e=>{const{action:s}=e.data;if(!t._j[s]||"function"!=typeof t._j[s])return self.postMessage({status:422,action:s,result:"Invalid request"});t._j[s](e.data)})}))})();