(()=>{"use strict";var t,e={94:(t,e,s)=>{s.d(e,{q1:()=>o,hB:()=>l,sh:()=>i,ho:()=>r,_j:()=>a,Ch:()=>u,V5:()=>d});const{buildingsController:n}=s(402),a={host:n.setBuildingsHostURL,key:n.setBuildingsApiKey,init:n.storeBuildings,list:n.getBuildingsList,data:n.getBuildingsData,search:n.searchBuilding,getById:n.getBuildingDataById,getByAddress:n.getBuildingDataByAddress,put:n.putBuildingData,post:n.postBuildingData},r=function(){let t="https://dgtek-staging.herokuapp.com";return function(e){if(!e)return t;t=e}}(),o=function(){let t="";return function(e){if(!e)return t;t=e}}(),i=["lit","footprint","build","soon","other","current"],u={lit:"LIT",footprint:"Footprint",build:"BuildCommenced",soon:"ComingSoon",other:"Other"},l={status:"Footprint",estimatedServiceDeliveryTime:"",coordinates:[0,0],address:"",addressComponents:{number:"",street:"",streetType:"",city:"",state:"",postCode:"",cadastralIdentifier:""},footprint:!1,distanceFromFootprint:0,owner:{corporationName:"",contactPerson:"",corporationPhoneWork:"",corporationPhoneMobile:"",corporationEmailPrimary:"",corporationEmailAlternative:""},management:{managerName:"",managerPhoneWork:"",phoneWork:"",phoneMobile:"",emailPrimary:"",emailAlternative:""},buildingName:"",buildingType:"dwelling=,type=,category=,field=",customerInstallApprovalRequired:!0,inductionRequired:!0,difficultyLevel:{leadInInstallation:0,backboneInstallation:0,customerInstallation:0},infrastructure:{type:"",leadIn:{planned:!1,installed:!1},backbone:{planned:!1,installed:!1},customerAccessCabling:{planned:!1,installed:!1},gPOinMDF:{exist:!1,planned:!1,installed:!1},uPSinMDF:{planned:!1,installed:!1},gPOinRisers:{exist:!1,planned:!1,installed:!1},uPSinRisers:{planned:!1,installed:!1}},files:{design:"",laanInspect:"",laanInstall:"",scope:"",photos:[],approoval:""},numberOfLevels:0,numberOfDwellings:0,avgFloorHeight:0,levels:[{plannedRouter:!1,plannedSplicingBox:!1,plannedSplitter:!1,plannedOFTU:!1,plannedRack:!1,installedRouter:!1,installedSplicingBox:!1,installedSplitter:!1,installedOFTU:!1,installedRack:!1,routerId:""}]},d={lit:{event:"on-net",buildingStatus:"LIT",polygonStatus:"ServiceAvailable"},footprint:{event:"footprint",buildingStatus:"Footprint",polygonStatus:"ServiceAvailable"},build:{event:"construction-commenced",buildingStatus:"BuildCommenced",polygonStatus:"UnderConstruction"},soon:{event:"coming-soon",buildingStatus:"ComingSoon",polygonStatus:"ComingSoon"},other:{event:"not-available",buildingStatus:"Other",polygonStatus:null}}},402:(t,e,s)=>{s.r(e),s.d(e,{buildingsController:()=>f});var n=s(94);const a=()=>new Promise((t=>Object.assign(indexedDB.open("buildings"),{onupgradeneeded:t=>{for(const e of n.sh)t.target.result.createObjectStore(e);return t.target.result},onsuccess:e=>t({status:200,result:e.target.result}),onerror:e=>t({status:700,result:null})}))),r=async(t,e,s)=>new Promise((n=>{a().then((a=>{const{status:r,result:o}=a;if(200!==r)return void n({status:r,result:"Open local DB error"});const i=o.transaction([t],"readwrite").objectStore(t);Object.assign(i.put(s,e),{onsuccess:()=>n({status:200,result:s}),onerror:()=>n({status:708,result:`Local DB saving data error: ${e}`})})}))})),o=(t,e)=>new Promise((s=>{a().then((n=>{const{status:a,result:r}=n;if(200!==a)return void s({status:a,result:null});const o=r.transaction([t]).objectStore(t);Object.assign(o.get(e),{onsuccess:n=>s({status:n.target.result?200:404,result:n.target.result?n.target.result:`The data ${e} not found in db store ${t}`}),onerror:t=>s({status:704,result:t.target.error})})}))})),i=t=>new Promise((e=>{a().then((s=>{const{status:n,result:a}=s;if(200!==n)return void e({status:n,result:null});const r=a.transaction([t],"readwrite").objectStore(t);Object.assign(r.clear(),{onsuccess:t=>e({status:200,result:null}),onerror:s=>e({status:704,result:`Cleaning ${t}: operation failed`})})}))})),u=async t=>{if(!navigator.onLine)return{status:0,result:"Offline mode: Data has not been saved. Try later"};const[e,s]=["getById",t],a=await fetch(`${(0,n.ho)()}/building/${t}`);if(200!==a.status)return{status:a.status,action:e,key:s,result:`Error reading building ${t} data`};const o=(await a.json()).data;return await r("current","data",o),{status:a.status,action:e,store:o.status,key:s,result:o}},l=(t,e)=>({status:t,action:"put",key:e,error:!0,errorType:"Save building details",errorMessage:"Operation failed"}),d=(t,e="Operation failed")=>({status:t,action:"post",error:!0,errorType:"Create new building",errorMessage:e}),c=async t=>{if(!navigator.onLine)return{status:0,result:"Offline mode"};const e="store",s=await fetch(`${(0,n.ho)()}/building`);if(200!==s.status)return{status:s.status,result:"Error reading data from server"};const a=(await s.json()).data;for(const t in n.Ch){const{status:s,result:o}=await i(t),u=a.filter((e=>e.status===n.Ch[t]));for(const s of u){const{address:n}=s,{status:a,result:o}=await r(t,p(n),s);200!==a&&self.postMessage({status:a,action:e,store:t,result:n})}}return{status:200,action:e,result:"Success"}},g=async t=>{const[e,s]=["search",t];for(const a in n.Ch){const{status:n,result:r}=await o(a,t);if(200===n)return{status:n,action:e,store:a,key:s,result:r}}return{status:404,action:e,key:s,result:`Building ${t} not found`}},p=function(t){const e=t.indexOf(", Australia");return(-1!==e?t.slice(0,e-t.length):t).toLocaleUpperCase()},f=new class{setBuildingsHostURL(t){self.postMessage((0,n.ho)(t.data))}setBuildingsApiKey(t){self.postMessage((0,n.q1)(t.data))}async storeBuildings(){self.postMessage(await c())}async getBuildingsList(t){self.postMessage(await(async t=>{const[e,s]=["list",t];if(-1===Object.keys(n.Ch).indexOf(t))return{status:422,action:e,store:s,result:`Invalid request: type ${t} not found`};const{status:r,result:o}=await(i=t,new Promise((t=>{a().then((e=>{const{status:s,result:n}=e;if(200!==s)return void t({status:s,result:null});const a=n.transaction([i]).objectStore(i);return Object.assign(a.getAllKeys(),{onsuccess:e=>t({status:e.target.result?200:404,result:e.target.result?e.target.result:`No one key found in db store ${i}`}),onerror:e=>t({status:704,result:e.target.error})})}))})));var i;return{status:r,store:s,action:e,result:Object.assign(o,{event:n.V5[s].event,buildingStatus:n.V5[s].buildingStatus,polygonStatus:n.V5[s].polygonStatus})}})(t.key))}async getBuildingsData(t){self.postMessage(await(async t=>{const[e,s]=["data",t];if(-1===Object.keys(n.Ch).indexOf(t))return{status:422,action:e,store:s,result:`Invalid request: type ${t} not found`};const{status:r,result:o}=await(i=t,new Promise((t=>{a().then((e=>{const{status:s,result:n}=e;if(200!==s)return void t({status:s,result:null});const a=n.transaction([i]).objectStore(i);return Object.assign(a.getAll(),{onsuccess:e=>t({status:e.target.result?200:404,result:e.target.result?e.target.result:`No one key found in db store ${i}`}),onerror:e=>t({status:704,result:e.target.error})})}))})));var i;const u=o.map((t=>({id:t._id,address:t.address,addressComponents:t.addressComponents,estimatedServiceDeliveryTime:t.estimatedServiceDeliveryTime})));return{status:r,action:e,store:s,result:Object.assign(u,{event:n.V5[s].event,buildingStatus:n.V5[s].buildingStatus,polygonStatus:n.V5[s].polygonStatus})}})(t.key))}async searchBuilding(t){self.postMessage(await g(t.key))}async getBuildingDataById(t){self.postMessage(await u(t.key))}async getBuildingDataByAddress(t){self.postMessage(await(async t=>{const[e,s]=["getByAddress",t],n=await g(t);if(200!==n.status)return{status:n.status,action:e,key:s,result};const{status:a,store:r,result:o}=await u(n.result._id);return{status:a,action:e,store:n.store,key:s,result:o}})(t.key))}async putBuildingData(t){self.postMessage(await async function(t,e){const[s,a]=["put",t];let r=await u(t);if(200!==r.status)return l(r.status,t);if(Object.assign(r.result,{...e}),self.postMessage({status:300,action:s,key:a,result:r.result}),!navigator.onLine)return{status:0,action:s,result:"Offline mode: Data has not been saved. Try later"};if(r=await fetch(`${(0,n.ho)()}/building/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:(0,n.q1)()},body:JSON.stringify(r.result)}),200!==r.status)return l(r.status,t);self.postMessage({status:300,action:s,key:a,result:await r.json()});const o=await c();return{action:s,key:a,status:r.status,result:o}}(t.key,t.data))}async postBuildingData(t){self.postMessage(await(async t=>{if(!navigator.onLine)return{action:"post",status:0,result:"Offline mode: Data has not been saved. Try later"};if(!t.status)return d(422,"Building status not defined");const e=Object.keys(n.Ch).find((e=>n.Ch[e]===t.status));if(!e)return d(422,`Invalid building status ${t.status}`);const s=Object.assign(n.hB,t),a=await fetch(`${(0,n.ho)()}/building`,{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:(0,n.q1)()},body:JSON.stringify(s)});if(200!==a.status)return d(a.status);const r=(await a.json()).data;return{status:200,action:"post",store:e,key:r,result:r}})(t.data))}}}},s={};function n(t){var a=s[t];if(void 0!==a)return a.exports;var r=s[t]={exports:{}};return e[t](r,r.exports,n),r.exports}n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(0,(t=n(94)).ho)("https://dgtek.herokuapp.com"),(0,t.q1)("rAxKIAyY9j3Aq0OZ4TnGHCibU9G6oZZP8NaMOlKeJV9U2qjOKu0xOOQwjw3JzKaewN4DmzQ97aEsUh1XyAsQboJqQpbFpgK0JQkt"),self.onmessage=e=>{const{action:s}=e.data;if(!t._j[s]||"function"!=typeof t._j[s])return self.postMessage({status:422,action:s,result:"Invalid request"});t._j[s](e.data)}})();